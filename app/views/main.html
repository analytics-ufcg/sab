<script type="text/javascript">
  var
    width = 800,
    height = 800;
var projection = d3.geo.mercator()
  .scale(2000)
  .translate([width * 2.5, height * 0.0]);
var path = d3.geo.path()
  .projection(projection);
var svg = d3.select("body").append("svg")
  .attr("width", width)
  .attr("height", height);

d3.json("http://localhost:5003/estados_brasil", function(error, br) {
  if (error) return console.error(error);

  var regioes = topojson.feature(br, br.objects.estado_sab);

  svg.selectAll(".municipio_br")
    .data(regioes.features)
    .enter()
      .append("path")
      .attr("class", function(d) {
        return "municipio_br" + d.id; })
      .attr("d", path)
      .style('opacity', '0.2')
      .style('fill', '#08306B')
      .style('stroke', '#08306B');
});

d3.json("http://localhost:5003/limites_sab", function(error, br) {
  if (error) return console.error(error);
  var limites = topojson.feature(br, br.objects.limite_sab);
  var color_scale = d3.scale.linear().domain([0, limites.features.length]).range(['#DEEBF7', '#08306B']);

  svg.selectAll(".limites_sab")
    .data(limites.features)
    .enter()
      .append("path")
      .attr("class", function(d) {
        return "limites_sab" + d.id; })
      .attr("d", path)
      // .style('fill', function(d, k) {
      //   return color_scale(k); });
      .style('opacity', '0.2')
      .style('fill', '#8c4545')
      .style('stroke', '#8c4545');
});

var tooltip = d3.select("body")
  .append("div")
  .style("position", "absolute")
  .style("z-index", "10")
  .style("visibility", "hidden");

var text = ''

var mouseOnEvent = function(d) {
  d3.json("http://localhost:5003/info_reservatorios/" + d.id, function(error, r) {
        tooltip.text("Reservatorio: " + r["Reservat贸rio_ANA_JU"]["0"]["Bacia"] + "\n" + "Estado: " + r["Reservat贸rio_ANA_JU"]["0"]["Estado"] + 
          "\n" + "Capacidade: " + r["Reservat贸rio_ANA_JU"]["0"]["Cap (hm3)"]).style("visibility", "visible");
        console.log(r["Reservat贸rio_ANA_JU"]);
      });
      var destaque = d3.select(this);
      // transition to increase size/opacity of bubble
      destaque.transition()
            .duration(800).style("opacity", 1);
};

var mouseMoveEvent = function() {
  tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");
};

var mouseOffEvent = function(d) {
  var destaque = d3.select(this);
          // transition to increase size/opacity of bubble
          destaque.transition()
                .duration(800).style("opacity", 0.3);

          tooltip.style("visibility", "hidden");
};

d3.json("http://localhost:5003/reservatorios_sab", function(error, r) {
  if (error) return console.error(error);
  var reservatorio = topojson.feature(r, r.objects.reservatorios_geojson);
  svg.selectAll(".reservatorio")
    .data(reservatorio.features)
    .enter()
      .append("path")
      // .translate(10, 10)
      .attr('id', function(d) {
        return d.id; })
      .attr("class", function(d) {
        return "reservatorio" + d.id; })
      .attr("d", path)
      .style('fill', '#08306B')
      .style("opacity", 0.3)
        .on("mouseover", mouseOnEvent)
        .on("mousemove", mouseMoveEvent)
        .on("mouseout", mouseOffEvent)
      .attr("width", 10)
      .attr("height", 10);;
});
</script>
