<section class="map-container">
  <div id="map">

  </div>
</section>
<script type="text/javascript">
var
  width = 800,
  height = 800;
var projection = d3.geo.mercator()
  .scale(2000)
  .translate([width * 2.5, height * 0.0]);
var path = d3.geo.path().projection(projection);
var zoom = d3.behavior.zoom()
    .translate([0, 0])
    .scale(1)
    .scaleExtent([1, 8])
    .on("zoom", zoomed);
var svg = d3.select("#map")
  .append("svg")
  .attr("version", "1.1")
  .attr("viewBox", "0 0 "+width+" "+height)
  .attr("width", "100%")
  .attr("height", "auto");

var features = svg.append("g");

svg.append("rect")
    .attr("class", "map-overlay")
    .attr("width", width)
    .attr("height", height)
    .call(zoom);

d3.json("http://localhost:5003/regioes_brasil_topoJSON", function(error, br) {
  if (error) return console.error(error);

  var regioes = topojson.feature(br, br.objects.br);

  features.append("path")
    .datum(regioes)
    .attr("class", "brasil")
    .attr("d", path)
    .style('opacity', '0.2')
    .style('fill', '#08306B')
    .style('stroke', '#08306B');
});

d3.json("http://localhost:5003/cidades_sab", function(error, br) {
  if (error) return console.error(error);

  var municipios = topojson.feature(br, br.objects.municipios_sab);

  features.append("path")
    .datum(municipios)
    .attr("class", "sab")
    .attr("d", path)
    .style('opacity', '0.2')
    .style('fill', '#8c4545')
    .style('stroke', '#8c4545');
});

d3.json("http://localhost:5003/reservatorios_sab", function(error, r) {
  if (error) return console.error(error);

  var reservatorio = topojson.feature(r, r.objects.reservatorios_geojson);

  features.append("path")
    .datum(reservatorio)
    .attr("class", "reservatorio")
    .attr("d", path)
    .style('fill', '#08306B')
    .attr("width", 10)
    .attr("height", 10);
});

function zoomed() {
  features.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
  features.select(".state-border").style("stroke-width", 1.5 / d3.event.scale + "px");
  features.select(".county-border").style("stroke-width", .5 / d3.event.scale + "px");
}
</script>
